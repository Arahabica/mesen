# タッチ操作仕様

## モード一覧

- **初期状態**: none
- **移動**: move
- **調整**: adjust
- **描画**: draw
- **黒線移動**: moveLine

## 指１本のタッチ処理フロー

### 1. 指１本のタッチ開始
- modeは`none`

### 2. 描画された黒線からの位置チェック
- **黒線の中**: 近い
- **黒線から表示上のpixel距離が20px以内**: 近い

## 2.1 線から近い場合

### 2.1.1 100msの間は何もしない
- まだmodeは`none`

### 2.1.2 100ms後も指が離されていなかった場合、黒線移動に移行
#### 2.1.2.1 黒線移動モード中に指を移動すると黒線を移動することができる

### 2.1.3 100ms以内に指を離すと黒線タップと判定する
- 黒線タップを行うと、太さの変更を行う

## 2.2 線から遠い場合

### 2.2.1 100msの間は何もしない
- まだmodeは`none`

### 2.2.2 100msの間の移動量で移動モードか調整モードかを判定
- **判定基準**: 移動量が3px以上
- **追加**: 調整モードに入った後でも200ms以内に大きな移動（6px以上）があれば移動モードに切り替え

#### 2.2.2.1 移動モードの場合

##### 2.2.2.1.1 指を移動させる(Drag & Drop)
- 画像の位置が調整される

##### 2.2.2.1.2 指を離す
- modeが`none`に戻る
- **指を離すまでは他のモードには移行しない**

#### 2.2.2.2 調整モードの場合

##### 2.2.2.2.1 指の近くにルーペが表示される

##### 2.2.2.2.2 指を移動するとルーペも移動する

##### 2.2.2.2.3 指を止めて1秒経つと描画モードに移行

###### 2.2.2.2.3.1 描画モード
- ルーペは引き続き表示
- 指を移動させると、線が引かれる
- 指を離すと、調整モード終了時のポイントと指を離したポイントの間の線が引かれる

#### 2.2.2.3 100ms以内に指を離している
- **タップ**と判定する
- 短い期間(300ms)以内に近い場所(30px以内)を2連続タップするとダブルタップと判定する
- **ダブルタップされたら、scaleを調整する**
  - 縮尺が初期状態であれば、2.5倍に修正
  - 縮尺が初期状態でなければ、初期状態に修正